<p id="notice"><%= notice %></p>

<div class="title">
  <span id="major"><%=@recipe.name %></span><br/>
  <span id="minor"><%= @recipe.version %> (revision <%= @recipe.revision %>)</span>
</div>

<div style="width: 100%; display: inline-block;">
  <div style="float: left; width: 70%; padding-right: 5px">
    <div class="subtitle">
      <span id="major">Information</span><br/>
    </div>
    <div class="CodeRay">
      <div style="padding: 10px;">
        <strong>Category:</strong>
        <%= @recipe.category %><br/>
        <strong>Filename:</strong>
        <%= @recipe.filename %><br/>
        <strong>Lint:</strong>
        <%=raw @recipe.lint[:clean] ? "<span style='color: green'>Passing</span>" : "<span style='color: red'>Failing</span>" %>
      </div>
    </div>
  </div>

  <div style='float: right; width: 29%'>
    <div class="subtitle">
      <span id="major">Packages</span><br/>
    </div>
  <table style="border: 1px solid black; border-spacing: 0px; table-layout: fixed; width: 100%">
	<thead>
		<tr bgcolor="#aaa" style="font-size: 0.8em; text-align: center;">
			<% @architectures.each do |arch| %>
				<td bgcolor="<%= cycle('#ccc', '#ddd') -%>"><b><%= arch.name %></b></td>
			<% end %>
		</tr>
	</thead>
	<tbody>
		<tr style="font-size: 0.9em; text-align: center;" bgcolor="<%= cycle('#eee', '#fff') -%>">
			<% @recipe.packages.joins(:architecture).order('architectures.name').each do | package | %>
				<% hpkgname = "#{@recipe['name']}-#{@recipe['version']}-#{package.latestrev}-#{package.architecture['name']}.hpkg" %>
				<td bgcolor="<%= cycle('#F2F2F2', '#fff') -%>">
				<% if package.latestrev == 0 %>
					<%= image_tag "icons/box-missing.png" %>
				<% elsif package.latestrev == @recipe.revision %>
					<%= link_to image_tag("icons/box-exists.png"), "#{package.repo['url']}/hpkg/#{hpkgname}" %>
				<% else %>
					<%= link_to image_tag("icons/box-outdated.png"), "#{package.repo['url']}/hpkg/#{hpkgname}" %>
                <% end %>
				<br/>Revision <%= package.latestrev %>
				</td>
			<%-end-%>
		</tr>
	</tbody>
</table>
</div>
</div>

<div class="subtitle">
  <span id="major">Builds Results</span><br/>
</div>
<table style="border: 1px solid black; border-spacing: 0px; table-layout: fixed; width: 100%">
	<thead>
		<tr bgcolor="#ccc" style="font-size: 0.8em;">
			<td>Build</td><td>Builder</td><td>Architecture</td><td>Start date</td><td>End date</td><td>Result</td>
		</tr>
	</thead>
	<tbody>
	<% @recipe.builds.each do | build | %>
	<tr bgcolor="<%= cycle('#f2f2f2', '#fff') -%>">
		<td><%= link_to "##{build['id']}", build %></td>
		<td><%= link_to build.builder['hostname'], build.builder %></td>
		<td><%= build.architecture['name'] %></td>
		<td><%= build['issued'] %></td>
		<td><%= build['completed'] %></td>
		<td><%= build['result'] %></td>
	</tr>
	<% end %>
	</tbody>
</table>

<div class="subtitle">
  <span id="major">Current Recipe</span><br/>
</div>
<%=raw CodeRay.highlight_file("#{Rails.application.config.haikuports}/#{@recipe.filename}") %>

<div class="subtitle">
  <span id="major">Lint Results</span><br/>
</div>
<div class="CodeRay">
<div style="padding: 10px;">
<%=raw @recipe.lint[:result] %>
</div>
</div>

</div>
</div>
